function GridData(n) { function f(n) { var e, s, f, r, o, h, u; for ($(t.tableId).addClass("table table-bordered table-striped table-hover with-check").attr("style", "width: 100%"), e = "", s = "", t.rowNumber && (e += "<th class='number'><\/th>"), t.checkBox && (e += "<th style='width:15px;'><input type='checkbox' class='chk' id='" + i + "_chkAll' onclick='ChkAll(this)'/><\/th>"), f = 1; f < t.column[0].length; f++) e += t.column[0][f].width ? "<th class='datagrid-th' style='width:" + t.column[0][f].width + "'><div class='datagrid-cell'>" + t.column[0][f].title + "<\/div><\/th>" : "<th class='datagrid-th' ><div class='datagrid-cell'>" + t.column[0][f].title + "<\/div><\/th>"; for (r = 0; r < n.Rows.length; r++) { for (o = "", h = parseInt((t.param.Page - 1) * t.param.RP + r), t.rowNumber && (o += "<td class='td_number'>" + (h + 1) + "<\/td>"), t.checkBox && (o += "<td class='t_one'><input type='checkbox' class='chk' id=" + i + "_chk_" + r + " name='chk' value=\"" + n.Rows[r][t.column[0][0].field] + '"/><\/td>'), u = 1; u < t.column[0].length; u++) o += t.column[0][u].formatter ? "<td>" + t.column[0][u].formatter(n.Rows[r][t.column[0][u].field], h, n.Rows[r]) + "<\/td>" : t.isCheckNull ? "<td>" + CheckNull(n.Rows[r][t.column[0][u].field]) + "<\/td>" : "<td>" + n.Rows[r][t.column[0][u].field] + "<\/td>"; s += "<tr>" + o + "<\/tr>" } $(t.tableId).append("<thead><tr>" + e + "<\/tr><\/thead>" + s); switch (t.textAlign) { case "center": $(t.tableId + " th:not(.t_one)," + t.tableId + " td:not(.t_one)").css("text-align", "center"); break; default: $(t.tableId + " th:not(.t_one)," + t.tableId + " td:not(.t_one)").css("text-align", "left") } l(); a() } function e(n) { $("#" + t.foolerId).addClass("page-left left"); var i = n.Total == 0 ? 0 : (t.param.Page - 1) * t.param.RP + 1, r = t.param.Page * t.param.RP <= n.Total ? t.param.Page * t.param.RP : n.Total; $("#" + t.foolerId).append("<div class='page-txt'>第" + i + "-" + r + "条  /  共" + n.Total + "条数据<\/div>") } function o() { var i, n; if (t.pageList.length > 0) { for (i = "<select id='" + t.pageSelect + "' class='select-option'>", n = 0; n < t.pageList.length; n++) i += "<option value='" + t.pageList[n] + "'>每页" + t.pageList[n] + "条<\/option>"; i += "<\/select>"; $("#" + t.selectionId).append(i); $("#" + t.pageSelect).val(t.param.RP) } $("#" + t.selectionId).append("<div class='refresh' title='刷新'><\/div>"); $("#" + t.selectionId + " .refresh").click(function () { r.ReLoad() }); $("#" + t.pageSelect).change(function () { t.param.Page = 1; t.param.RP = this.value; r.ReLoad() }) } function s(n) { var u = 0, i, f, e; u = n.Total % t.param.RP == 0 ? n.Total / t.param.RP : parseInt(n.Total / t.param.RP) + 1; i = ""; t.param.Page > 1 && (i += "<li><a>最前页<\/a><\/li><li><a>上一页<\/a><\/li>"); switch (u) { case 0: i += ""; break; case 1: i += "<li><a>1<\/a><\/li>"; break; case 2: i += "<li><a>1<\/a><\/li><li><a>2<\/a><\/li>"; break; case 3: i += "<li><a>1<\/a><\/li><li><a>2<\/a><\/li><li><a>3<\/a><\/li>"; break; default: if (t.param.Page <= 3) for (f = 1; f <= (t.param.Page + 3 > u ? u : t.param.Page + 3) ; f++) i += f == t.param.Page ? "<li class='active'><a>" + f + "<\/a><\/li>" : "<li><a>" + f + "<\/a><\/li>"; else for (e = t.param.Page - 3; e <= (t.param.Page + 3 > u ? u : t.param.Page + 3) ; e++) i += e == t.param.Page ? "<li class='active'><a>" + e + "<\/a><\/li>" : "<li><a>" + e + "<\/a><\/li>" } t.param.Page < u && (i += "<li><a>下一页<\/a><\/li><li><a>最末页<\/a><\/li>"); $("#" + t.paginationId).append(i); $("#" + t.paginationId + " li").each(function () { $(this).css("cursor", "pointer"); $(this).click(function () { var n = 0; switch (this.innerHTML.toLowerCase().replace("<a>", "").replace("<\/a>", "")) { case "最前页": n = 1; break; case "上一页": n = t.param.Page - 1; break; case "最末页": n = u; break; case "下一页": n = t.param.Page + 1; break; default: n = parseInt(this.innerHTML.toLowerCase().replace("<a>", "").replace("<\/a>")) } r.LoadDataPage(n) }) }); $("#" + t.paginationId + " li:first").addClass("first"); $("#" + t.paginationId + " li:contains(" + t.param.Page + ")").addClass("active") } function h() { t.tableHeader != null && $("#" + i + "_tableHeader").html(t.tableHeader) } function c(n) { var u, r; if ($("#" + t.baseToolbar).remove(), $("#" + i + "_tableHeader").remove(), n != null && n.length >= 1) { for (u = "<div id='" + t.baseToolbar + "' class='operate'>", r = 0; r < n.length; r++) u += " <a href='javascript:void(0);' id='" + t.tableId + "_" + n[r].id + "' ><i class='icon " + n[r].icon + "'><\/i>" + n[r].text + "<\/a>"; u += "<\/div><div id=" + i + "_tableHeader><\/div>"; $(t.tableId).before(u); $(n).each(function (n, i) { $("a[id='" + t.tableId + "_" + i.id + "']").click(function () { i.handler() }) }) } } function l() { t.selectOnCheck && t.checkBox && (t.multipleSelect ? $(t.tableId + " tr").not($(t.tableId + " tr:first")).each(function (n, t) { $(t).find("td:not(.t_one)").click(function () { var t = $("#" + i + "_chk_" + n)[0]; t.checked = t.checked ? !1 : !0 }) }) : $(t.tableId + " tr").not($(t.tableId + " tr:first")).each(function (n, r) { $(r).find("td:not(.t_one)").click(function () { var r = $("#" + i + "_chk_" + n)[0]; r.checked = r.checked ? !1 : !0; $(t.tableId + " tr").not($(t.tableId + " tr:first")).each(function (t) { if (t != n) { var r = $("#" + i + "_chk_" + t)[0]; r.checked = !1 } }) }) })) } function a() { var i = 0, r = 0, n = !1; $(t.tableId + " .datagrid-cell").mousemove(function (t) { var u = t; i = this.offsetWidth; computePx(this) + i - u.clientX <= 3 && computePx(this) + i > u.clientX ? ($(this).attr("style", "cursor:e-resize"), r = u.clientX, n = !0) : ($(this).removeAttr("style"), n = !1) }); $(t.tableId + " .datagrid-cell").mousedown(function () { if (n) { var f = this, e = $(t.tableId)[0].offsetWidth, o = $(t.tableId)[0].offsetHeight, s = computePy($(t.tableId)[0]), u = computePx($(t.tableId)[0]), h = "<div class='layout' style='width:" + e + "px;height:" + o + "px;top:" + s + "px;left:" + u + "px'><div class='verticalLine' style='left:" + (r - u + 5) + "px'><div class='lineContent'>左右拖动<\/div><\/div><\/div>"; $(this).after(h); $(".layout").mousemove(function (t) { var e, f; n && (e = t, $(".verticalLine").css("left", e.clientX - u), f = i + 14 - (r + 6) + e.clientX, f <= 30 ? (f = "亲,列宽太小了", $(".lineContent").css("background-color", "#d60000"), $(".verticalLine").css("border-left-color", "#d60000")) : (f = "宽度:" + f, $(".lineContent").css("background-color", "#006dcc"), $(".verticalLine").css("border-left-color", "#006dcc")), $(".lineContent").text(f)) }); $(".layout").mouseup(function (u) { var o = u, e; n = !1; e = i + 14 - (r + 6) + o.clientX; e < 30 && (e = 30); $(f).parent().animate({ width: e }, 500); $(t.tableId).unbind("mousemove"); $(".layout").remove() }) } }); $(t.tableId + " .datagrid-cell").mouseup(function () { n = !1 }) } var r = this, t, i, u; if (n.tableId == null || n.tableId == "") throw "未指定tableId"; t = { checkBox: !0, rowNumber: !0, isFooter: !0, isPagination: !0, param: new DataGridParam(1, 5), textAlign: "left", isCheckNull: !0, selectOnCheck: !0, multipleSelect: !0 }; t.url = n.url; t.column = n.column; t.tableId = n.tableId; t.toolbar = n.toolbar; t.tdata = n.tdata; t.pageList = n.pageList; t.tableHeader = n.tableHeader; n.ajaxSuccess && (t.ajaxSuccess = n.ajaxSuccess); n.loadSuccess && (t.loadSuccess = n.loadSuccess); n.checkBox != null && n.checkBox == !1 && (t.checkBox = n.checkBox); n.rowNumber != null && n.rowNumber == !1 && (t.rowNumber = n.rowNumber); n.isFooter != null && n.isFooter == !1 && (t.isFooter = n.isFooter); n.isPagination != null && n.isPagination == !1 && (t.isPagination = n.isPagination); n.param != null && (t.param = n.param); n.textAlign != null && (t.textAlign = n.textAlign); n.isCheckNull != null && (t.isCheckNull = n.isCheckNull); n.multipleSelect != null && n.multipleSelect == !1 && (t.multipleSelect = n.multipleSelect); i = t.tableId.replace("#", ""); t.foolerId = i + "_datafooter"; t.paginationId = i + "_dataPage"; t.selectionId = i + "_selection"; t.pageSelect = i + "_pageSelect"; t.baseToolbar = i + "_baseToolbar"; $("#" + i + "_base_footer").remove(); u = "<div id='" + t.selectionId + "' class='page-left left selection'><\/div>"; $(t.tableId).after(" <div id='" + i + "_base_footer' class='page cf'><div id='" + t.foolerId + "'><\/div>" + u + "<div class='pagination right'><ul id='" + t.paginationId + "' class='right'><\/ul><\/div><\/div>"); c(t.toolbar); h(); this.Option = t; this.getSelection = function () { var n = []; return $(t.tableId).find("input[name='chk']").each(function (t, i) { i.checked && n.push(i.value) }), n }; this.loadData = function () { t.tdata != null ? ($(t.tableId).empty(), $("#" + t.foolerId).empty(), $("#" + t.paginationId).empty(), $("#" + t.selectionId).empty(), t.ajaxSuccess ? t.ajaxSuccess(t.tdata) : f(t.tdata), o(), t.isFooter && e(t.tdata), t.isPagination && s(t.tdata), t.loadSuccess && t.loadSuccess(data)) : $.ajax({ url: t.url, type: "post", dataType: "json", data: t.param, beforeSend: function () { $("#" + t.foolerId).html("<div class='loading'><\/div>") }, success: function (n) { t.data = n; $(t.tableId).empty(); $("#" + t.foolerId).empty(); $("#" + t.paginationId).empty(); $("#" + t.selectionId).empty(); t.ajaxSuccess ? t.ajaxSuccess(n) : f(n); o(); t.isFooter && e(n); t.isPagination && s(n); t.loadSuccess && t.loadSuccess(n) } }) }; this.ReLoad = function () { this.loadData() }; this.LoadFirst = function () { t.param.Page = 1; this.loadData() }; this.LoadDataPage = function (n) { t.param.Page = n; this.loadData() } } function computePx(n) { for (var t = n.offsetLeft; ;) if (n.offsetParent) n = n.offsetParent, t += n.offsetLeft; else break; return t } function computePy(n) { for (var t = n.offsetTop; ;) if (n.offsetParent) n = n.offsetParent, t += n.offsetTop; else break; return t } function DataGridParam(n, t) { this.Query = null; this.Page = n; this.RP = t } function ChkAll(n) { n.checked == !0 ? $("input[name=chk]").each(function (n, t) { t.checked == !1 && (t.checked = !0) }) : $("input[name=chk]").each(function (n, t) { t.checked == !0 && (t.checked = !1) }) } function CheckNull(n) { return n == null || n == "underfind" ? "" : n } $.table = function (n) { var t = new GridData(n); return t.loadData(), t };